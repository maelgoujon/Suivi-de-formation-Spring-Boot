<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
  <html>
    <head>
      <meta charset="UTF-8" />
      <link rel="icon" type="image/vnd.icon" href="/images/apeaj.ico" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <!-- Ajoutez les liens vers les fichiers CSS Bootstrap ici -->
      <link href="/css/bootstrap.min.css" rel="stylesheet" />
      <link href="/css/accueil.css" rel="stylesheet">
      <!-- Ajoutez les liens vers les fichiers JavaScript Bootstrap et jQuery ici -->
      <script src="/js/jquery-3.2.1.slim.min.js"></script>
      <script src="/js/popper.min.js"></script>
      <script src="/js/bootstrap.bundle.min.js"></script>      
      <title>Choisir fiche d'intervention</title>

    </head>
    <body>

          <!-- Barre de navigation Bootstrap -->
    <nav class="navbar bg-body-tertiary">
      <div class="container d-flex justify-content-between align-items-center">
          <!-- Bouton gauche pour le mot de passe oublié -->
          <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#modalMdpOublie">
              <img src="/images/mdp_oublie.png" alt="Mot de Passe Oublié?" width="50" height="50">
          </button>

          <!-- Logo accueil au centre -->
          <a class="navbar-brand mx-auto" href="/">
              <img src="/images/accueil.png" alt="Accueil" width="50" height="50">
          </a>

          <!-- Bouton droit pour l'admin -->
          <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#modalConnexionAdmin">
              <img src="/images/admin.png" alt="Connexion Admin" width="50" height="50">
              Admin
          </button>
      </div>
  </nav>
  <div class="modal fade" id="modalMdpOublie" tabindex="-1" aria-labelledby="modalMdpOublieLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalMdpOublieLabel">Réinitialisation du mot de passe</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body">
                <p>Demander de l'aide à un formateur <img type="button" src="/images/son.png" alt="Lire le nom"
                        onclick="lireTexte('Demander de l\'aide à un formateur')" style="width: 20px;"></p>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalConnexionAdmin" tabindex="-1" aria-labelledby="modalConnexionAdminLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalConnexionAdminLabel">Connexion Admin</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body">
                <form id="adminLoginForm" th:action="@{/login}" method="post">
                    <div class="mb-3">
                        <label for="adminUsername" class="form-label">Nom d'utilisateur</label>
                        <input type="text" class="form-control" id="adminUsername" name="username" required>
                    </div>
                    <div class="mb-3">
                        <label for="adminPassword" class="form-label">Mot de passe</label>
                        <input type="password" class="form-control" id="adminPassword" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Se Connecter</button>
                    <button type="button" class="btn btn-secondary" data-bs-container="body"
                        data-bs-toggle="popover" data-bs-placement="bottom"
                        data-bs-content="Demander de l'aide au SUPERADMIN">
                        Mot de Passe Oublié ?
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>




<tbody>
  <tr th:each="fiche : ${fiches}" th:if="${fiche.utilisateur.nom == userrr.nom}">
    <td id="tdNomIntervenant" th:text="${fiche.utilisateur.nom} + ' ' + ${fiche.utilisateur.prenom}"></td>
    <td id="tdNomDemandeur" th:text="${fiche.nomDemandeur}"></td>
    <td id="tdDateDemande" th:text="${fiche.dateDemande}" style="display: none"></td>
    <td id="tdDateIntervention" th:text="${fiche.DateIntervention}"></td>
    <td id="tdDateCreation" th:text="${fiche.dateCreation}"></td>
    <td id="tdDegreUrgence" th:text="${fiche.DegreUrgence}" style="display: none"></td>
    <td id="tdTypeIntervention" th:text="${fiche.maintenanceType}"></td>
    <td id="tdNatureIntervention" th:text="${fiche.typeIntervention}"></td>
    <td id="tdEtatFicheFinie" th:text="${fiche.etatFicheFinie ? 'Oui' : 'Non'}"></td>
    <td id="tdNouvelleIntervention" th:text="${fiche.nouvelleIntervention ? 'Oui' : 'Non'}"></td>
    <td id="tdDureeIntervention" style="display: none" th:text="${fiche.dureeIntervention}"></td>
    <td id="tdLocalisation" style="display: none" th:text="${fiche.localisation}"></td>
    <td id="tdDescriptionDemande" style="display: none" th:text="${fiche.description}"></td>
    <td id="tdTravauxRealises" style="display: none" th:text="${fiche.travauxRealises}"></td>
    <td id="tdTravauxNonRealises" style="display: none" th:text="${fiche.travauxNonRealises}"></td>
    <td id="tdFiche">
      <a th:href="@{/fiche/{id}(id=${fiche.id})}">Voir détails</a>
    </td>
    <td id="tdEvaluation">
      <a th:href="@{/record/{id}(id=${fiche.id})}">Laisser une évaluation</a>
      <a th:href="@{/recordaffichage/{id}(id=${fiche.id})}">Ecouter l'évaluation</a>
    </td>
  </tr>
</tbody>

      <div class="container">
        <div class="title">
          <h4>
            Choisir une fiche d'intervention<img
              src="/images/son.png"
              alt="Lire le nom"
              onclick="lireTexte('Choisir une fiche d intervention')"
              style="width: 20px; margin: 5px"
            />
          </h4>
          <img class="image2" src="/images/assignment_icon.png" />
        </div>

        <div class="fInters" id="Inters ">
          <div class="fInter" th:classappend="${selectedPaper == 'Plomberie' ? 'fInter selected' : ''}" th:onclick="selectPaper('Plomberie')">
            <p class="name" th:href="@{/index(sujet='Plomberie')}">
              Plomberie<img
                src="/images/son.png"
                alt="Lire le nom"
                onclick="lireTexte('Plomberie')"
                style="width: 20px; margin: 5px"
              />
            </p>
          </div>
          <div class="fInter" th:classappend="${selectedPaper == 'Finition' ? 'fInter selected' : ''}" th:onclick="selectPaper('Finition')">
            <p class="name" th:href="@{/index(sujet='Finition')}">
              Finition<img
                src="/images/son.png"
                alt="Lire le nom"
                onclick="lireTexte('Finition')"
                style="width: 20px; margin: 5px"
              />
            </p>
          </div>
          <div class="fInter" th:classappend="${selectedPaper == 'Serruerie' ? 'fInter selected' : ''}" th:onclick="selectPaper('Serruerie')">
            <p class="name" th:href="@{/index(sujet='Serruerie')}">
              Serruerie<img
                src="/images/son.png"
                alt="Lire le nom"
                onclick="lireTexte('Serruerie')"
                style="width: 20px; margin: 5px"
              />
            </p>
          </div>
          <div class="fInter">
            <div class="static" th:classappend="${selectedPaper == 'Aménagement' ? 'fInter selected' : ''}" th:onclick="selectPaper('Aménagement')">
              <p class="name" th:href="@{/index(sujet='Aménagement')}">
                Aménagement<img
                  src="/images/son.png"
                  alt="Lire le nom"
                  onclick="lireTexte('Aménagement')"
                  style="width: 20px; margin: 5px"
                >
              </p>
            </div>
          </div>
          <div class="fInter" th:classappend="${selectedPaper == 'Electricité' ? 'fInter selected' : ''}" th:onclick="selectPaper('Electricité')">
            <p class="name" th:href="@{/index(sujet='Electricité')}">
              Électricité<img
                src="/images/son.png"
                alt="Lire le nom"
                onclick="lireTexte('Electricité')"
                style="width: 20px; margin: 5px"
              />
            </p>
          </div>
        </div>
        <div class="buttonADD" th:if="${selectedPaper != null}">
          <button id="add">Se connecter</button>
          <!--<a id="add" href="/fiche/creer_intervention"><img src="/images/logo_plus.png" class="image" /></a>-->
        </div>
      </div>
    </body>
    <script>
      const Inters = document.getElementById('Inters');
      const addButton = document.getElementById("add");

      let selectedPaper = null;

    function selectPaper(sujet) {
      if (selectedPaper === sujet) {
        deselectPaper();
      } else {
        if (selectedPaper) {
            Inters.querySelector(`[th:onclick*="${selectedPaper}"]`).classList.remove('selected');
        }
        const paper = Inters.querySelector(`[th:onclick*="${sujet}"]`);
        paper.classList.add('selected');
        selectedPaper = sujet;
        addButton.style.display = 'block';
      }
    }

    function deselectPaper() {
      if (selectedPaper) {
        Inters.querySelector(`[th:onclick*="${selectedPaper}"]`).classList.remove('selected');
        selectedPaper = null;
        addButton.style.display = 'none';
      }
    }

    Inters.addEventListener('click', (event) => {
      const paper = event.target.closest('.fInter');
      if (paper) {
        selectPaper(paper);
      }
    });

    addButton.addEventListener("click", () => {
      if (selectedPaper) {
        window.location.href = 'index.html';
      }
    });

    function lireTexte(texte) {
      const syntheseVocale = window.speechSynthesis;
      const message = new SpeechSynthesisUtterance(texte);
      syntheseVocale.speak(message);
    }

    </script>
  </html>
</html>
